{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Bienvenido, {{ request.user.first_name }}</h2>
  <h5>Resumen de {{ estudiante.nombre }} ({{ estudiante.rut }})</h5>

  <div class="row row-cols-1 row-cols-md-3 g-4 mt-3">
    <!-- Actividades -->
    <div class="col">
      <div class="card bg-info text-white h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Actividades asignadas</h6>
            <h3 class="mb-0">{{ actividades_asignadas|length }}</h3>
          </div>
          <i class="fas fa-calendar-alt fa-2x"></i>
        </div>
      </div>
    </div>

    <!-- Cuotas pendientes -->
    <div class="col">
      <div class="card bg-warning text-white h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Cuotas pendientes</h6>
            <h3 class="mb-0">{{ cuotas_pendientes }}</h3>
            <small>Total: ${{ total_pendiente|floatformat:0 }}</small>
          </div>
          <i class="fas fa-exclamation-triangle fa-2x"></i>
        </div>
      </div>
    </div>

    <!-- Pagos realizados -->
    <div class="col">
      <div class="card bg-success text-white h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="card-title">Pagos realizados</h6>
            <h3 class="mb-0">{{ cuotas_pagadas }}</h3>
            <small>Total: ${{ total_pagado|floatformat:0 }}</small>
          </div>
          <i class="fas fa-check-circle fa-2x"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de pagos -->
  <div class="mt-5">
    <h5><i class="fas fa-money-check-alt me-2"></i>Detalle de pagos</h5>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Actividad</th>
          <th>Monto</th>
          <th>Fecha</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        {% for pago in pagos_estudiante %}
        <tr>
          <td>{{ pago.cuota.actividad.nombre }}</td>
          <td>${{ pago.monto|floatformat:0 }}</td>
          <td>{{ pago.fecha|date:"d/m/Y" }}</td>
          <td>
            {% if pago.estado == 'pagado' %}
            <span class="badge bg-success">Pagado</span>
            {% else %}
            <span class="badge bg-warning">Pendiente</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Notificaciones -->
  <div class="mt-5">
    <h5><i class="fas fa-bell me-2"></i>Notificaciones recientes</h5>
    {% for notif in notificaciones_estudiante %}
    <div class="alert alert-info">
      <strong>{{ notif.titulo }}</strong>: {{ notif.mensaje }}
      <small class="d-block text-muted">{{ notif.fecha_envio|date:"d/m/Y" }}</small>
    </div>
    {% empty %}
    <p>No hay notificaciones para mostrar.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}

